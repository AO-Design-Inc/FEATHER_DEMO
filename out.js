(()=>{var Gn=Object.create;var Un=Object.defineProperty;var qn=Object.getOwnPropertyDescriptor;var Xn=Object.getOwnPropertyNames;var $n=Object.getPrototypeOf,Wn=Object.prototype.hasOwnProperty;var Kn=p=>Un(p,"__esModule",{value:!0});var zn=(p,E)=>()=>(E||p((E={exports:{}}).exports,E),E.exports);var Zn=(p,E,Y)=>{if(E&&typeof E=="object"||typeof E=="function")for(let U of Xn(E))!Wn.call(p,U)&&U!=="default"&&Un(p,U,{get:()=>E[U],enumerable:!(Y=qn(E,U))||Y.enumerable});return p},Dn=p=>Zn(Kn(Un(p!=null?Gn($n(p)):{},"default",p&&p.__esModule&&"default"in p?{get:()=>p.default,enumerable:!0}:{value:p,enumerable:!0})),p);var jn=zn(kn=>{(function(p,E){typeof define=="function"&&define.amd?define([],function(){return E.call(p)}):p.webglUtils=E.call(p)})(kn,function(){"use strict";let p=this;function E(n){return n=n||p,n!==n.top}E()||(console.log("%c%s","color:blue;font-weight:bold;","for more about webgl-utils.js see:"),console.log("%c%s","color:blue;font-weight:bold;","https://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html"));function Y(n){p.console&&(p.console.error?p.console.error(n):p.console.log&&p.console.log(n))}function U(n,a,t,v){let u=v||Y,m=n.createShader(t);if(n.shaderSource(m,a),n.compileShader(m),!n.getShaderParameter(m,n.COMPILE_STATUS)){let l=n.getShaderInfoLog(m);return u("*** Error compiling shader '"+m+"':"+l+`
`+a.split(`
`).map((c,s)=>`${s+1}: ${c}`).join(`
`)),n.deleteShader(m),null}return m}function J(n,a,t,v,u){let m=u||Y,f=n.createProgram();if(a.forEach(function(c){n.attachShader(f,c)}),t&&t.forEach(function(c,s){n.bindAttribLocation(f,v?v[s]:s,c)}),n.linkProgram(f),!n.getProgramParameter(f,n.LINK_STATUS)){let c=n.getProgramInfoLog(f);return m("Error in program linking:"+c),n.deleteProgram(f),null}return f}function hn(n,a,t,v){let u="",m,f=document.getElementById(a);if(!f)throw"*** Error: unknown script element"+a;if(u=f.text,!t){if(f.type==="x-shader/x-vertex")m=n.VERTEX_SHADER;else if(f.type==="x-shader/x-fragment")m=n.FRAGMENT_SHADER;else if(m!==n.VERTEX_SHADER&&m!==n.FRAGMENT_SHADER)throw"*** Error: unknown shader type"}return U(n,u,t||m,v)}let P=["VERTEX_SHADER","FRAGMENT_SHADER"];function wn(n,a,t,v,u){let m=[];for(let f=0;f<a.length;++f)m.push(hn(n,a[f],n[P[f]],u));return J(n,m,t,v,u)}function cn(n,a,t,v,u){let m=[];for(let f=0;f<a.length;++f)m.push(U(n,a[f],n[P[f]],u));return J(n,m,t,v,u)}function L(n,a){if(a===n.SAMPLER_2D)return n.TEXTURE_2D;if(a===n.SAMPLER_CUBE)return n.TEXTURE_CUBE_MAP}function ln(n,a){let t=0;function v(f,l){let c=n.getUniformLocation(f,l.name),s=l.type,w=l.size>1&&l.name.substr(-3)==="[0]";if(s===n.FLOAT&&w)return function(h){n.uniform1fv(c,h)};if(s===n.FLOAT)return function(h){n.uniform1f(c,h)};if(s===n.FLOAT_VEC2)return function(h){n.uniform2fv(c,h)};if(s===n.FLOAT_VEC3)return function(h){n.uniform3fv(c,h)};if(s===n.FLOAT_VEC4)return function(h){n.uniform4fv(c,h)};if(s===n.INT&&w)return function(h){n.uniform1iv(c,h)};if(s===n.INT)return function(h){n.uniform1i(c,h)};if(s===n.INT_VEC2)return function(h){n.uniform2iv(c,h)};if(s===n.INT_VEC3)return function(h){n.uniform3iv(c,h)};if(s===n.INT_VEC4)return function(h){n.uniform4iv(c,h)};if(s===n.BOOL)return function(h){n.uniform1iv(c,h)};if(s===n.BOOL_VEC2)return function(h){n.uniform2iv(c,h)};if(s===n.BOOL_VEC3)return function(h){n.uniform3iv(c,h)};if(s===n.BOOL_VEC4)return function(h){n.uniform4iv(c,h)};if(s===n.FLOAT_MAT2)return function(h){n.uniformMatrix2fv(c,!1,h)};if(s===n.FLOAT_MAT3)return function(h){n.uniformMatrix3fv(c,!1,h)};if(s===n.FLOAT_MAT4)return function(h){n.uniformMatrix4fv(c,!1,h)};if((s===n.SAMPLER_2D||s===n.SAMPLER_CUBE)&&w){let h=[];for(let b=0;b<info.size;++b)h.push(t++);return function(b,T){return function(S){n.uniform1iv(c,T),S.forEach(function(g,y){n.activeTexture(n.TEXTURE0+T[y]),n.bindTexture(b,g)})}}(L(n,s),h)}if(s===n.SAMPLER_2D||s===n.SAMPLER_CUBE)return function(h,b){return function(T){n.uniform1i(c,b),n.activeTexture(n.TEXTURE0+b),n.bindTexture(h,T)}}(L(n,s),t++);throw"unknown type: 0x"+s.toString(16)}let u={},m=n.getProgramParameter(a,n.ACTIVE_UNIFORMS);for(let f=0;f<m;++f){let l=n.getActiveUniform(a,f);if(!l)break;let c=l.name;c.substr(-3)==="[0]"&&(c=c.substr(0,c.length-3));let s=v(a,l);u[c]=s}return u}function un(n,...a){n=n.uniformSetters||n;for(let t of a)Object.keys(t).forEach(function(v){let u=n[v];u&&u(t[v])})}function pn(n,a){let t={};function v(m){return function(f){if(f.value)switch(n.disableVertexAttribArray(m),f.value.length){case 4:n.vertexAttrib4fv(m,f.value);break;case 3:n.vertexAttrib3fv(m,f.value);break;case 2:n.vertexAttrib2fv(m,f.value);break;case 1:n.vertexAttrib1fv(m,f.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else n.bindBuffer(n.ARRAY_BUFFER,f.buffer),n.enableVertexAttribArray(m),n.vertexAttribPointer(m,f.numComponents||f.size,f.type||n.FLOAT,f.normalize||!1,f.stride||0,f.offset||0)}}let u=n.getProgramParameter(a,n.ACTIVE_ATTRIBUTES);for(let m=0;m<u;++m){let f=n.getActiveAttrib(a,m);if(!f)break;let l=n.getAttribLocation(a,f.name);t[f.name]=v(l)}return t}function rn(n,a){n=n.attribSetters||n,Object.keys(a).forEach(function(t){let v=n[t];v&&v(a[t])})}function on(n,a,t,v){let u=n.createVertexArray();return n.bindVertexArray(u),rn(a,t),v&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v),n.bindVertexArray(null),u}function bn(n,a,t){return on(n,a.attribSetters||a,t.attribs,t.indices)}function fn(n,a,t,v,u){a=a.map(function(c){let s=document.getElementById(c);return s?s.text:c});let m=cn(n,a,t,v,u);if(!m)return null;let f=ln(n,m),l=pn(n,m);return{program:m,uniformSetters:f,attribSetters:l}}function vn(n,a,t){rn(a,t.attribs),t.indices&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indices)}let sn=["","MOZ_","OP_","WEBKIT_"];function En(n,a){for(let t=0;t<sn.length;++t){let v=sn[t]+a,u=n.getExtension(v);if(u)return u}}function _(n,a){a=a||1;let t=n.clientWidth*a|0,v=n.clientHeight*a|0;return n.width!==t||n.height!==v?(n.width=t,n.height=v,!0):!1}function x(n,a){let t=0;return n.push=function(){for(let v=0;v<arguments.length;++v){let u=arguments[v];if(u instanceof Array||u.buffer&&u.buffer instanceof ArrayBuffer)for(let m=0;m<u.length;++m)n[t++]=u[m];else n[t++]=u}},n.reset=function(v){t=v||0},n.numComponents=a,Object.defineProperty(n,"numElements",{get:function(){return this.length/this.numComponents|0}}),n}function F(n,a,t){let v=t||Float32Array;return x(new v(n*a),n)}function C(n,a,t,v){t=t||n.ARRAY_BUFFER;let u=n.createBuffer();return n.bindBuffer(t,u),n.bufferData(t,a,v||n.STATIC_DRAW),u}function tn(n){return n!=="indices"}function A(n){let a={};return Object.keys(n).filter(tn).forEach(function(t){a["a_"+t]=t}),a}function I(n,a){if(a instanceof Int8Array)return n.BYTE;if(a instanceof Uint8Array)return n.UNSIGNED_BYTE;if(a instanceof Int16Array)return n.SHORT;if(a instanceof Uint16Array)return n.UNSIGNED_SHORT;if(a instanceof Int32Array)return n.INT;if(a instanceof Uint32Array)return n.UNSIGNED_INT;if(a instanceof Float32Array)return n.FLOAT;throw"unsupported typed array type"}function an(n){return n instanceof Int8Array||n instanceof Uint8Array}function en(n){return n.buffer&&n.buffer instanceof ArrayBuffer}function B(n,a){let t;if(n.indexOf("coord")>=0?t=2:n.indexOf("color")>=0?t=4:t=3,a%t>0)throw"can not guess numComponents. You should specify it.";return t}function K(n,a){if(en(n))return n;if(n.data&&en(n.data))return n.data;Array.isArray(n)&&(n={data:n}),n.numComponents||(n.numComponents=B(a,n.length));let t=n.type;t||a==="indices"&&(t=Uint16Array);let v=F(n.numComponents,n.data.length/n.numComponents|0,t);return v.push(n.data),v}function mn(n,a,t){let v=t||A(a),u={};return Object.keys(v).forEach(function(m){let f=v[m],l=a[f];if(l.value)u[m]={value:l.value};else{let c=K(l,f);u[m]={buffer:C(n,c),numComponents:l.numComponents||c.numComponents||B(f),type:I(n,c),normalize:an(c)}}}),u}function xn(n){return n.length?n:n.data}let Sn=/coord|texture/i,gn=/color|colour/i;function B(n,a){let t;if(Sn.test(n)?t=2:gn.test(n)?t=4:t=3,a%t>0)throw new Error(`Can not guess numComponents for attribute '${n}'. Tried ${t} but ${a} values is not evenly divisible by ${t}. You should specify it.`);return t}function _n(n,a){return n.numComponents||n.size||B(a,xn(n).length)}let An=["position","positions","a_position"];function O(n){let a;for(let f of An)if(f in n){a=f;break}a=a||Object.keys(n)[0];let t=n[a],v=xn(t).length,u=_n(t,a),m=v/u;if(v%u>0)throw new Error(`numComponents ${u} not correct for length ${v}`);return m}function Tn(n,a,t){let v={attribs:mn(n,a,t)},u=a.indices;return u?(u=K(u,"indices"),v.indices=C(n,u,n.ELEMENT_ARRAY_BUFFER),v.numElements=u.length):v.numElements=O(a),v}function Q(n,a){let t={};return Object.keys(a).forEach(function(v){let u=v==="indices"?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER,m=K(a[v],name);t[v]=C(n,m,u)}),a.indices?t.numElements=a.indices.length:a.position&&(t.numElements=a.position.length/3),t}function Z(n,a,t,v,u){let m=a.indices;t=t===void 0?n.TRIANGLES:t;let f=v===void 0?a.numElements:v;u=u===void 0?0:u,m?n.drawElements(t,f,n.UNSIGNED_SHORT,u):n.drawArrays(t,u,f)}function e(n,a){let t=null,v=null;a.forEach(function(u){let m=u.programInfo,f=u.bufferInfo,l=!1;m!==t&&(t=m,n.useProgram(m.program),l=!0),(l||f!==v)&&(v=f,vn(n,m.attribSetters,f)),un(m.uniformSetters,u.uniforms),Z(n,f)})}function r(n,a){let t=[];for(let v in n)n[v]===a&&t.push(v);return t.length?t.join(" | "):`0x${a.toString(16)}`}return!!!document.documentMode&&!!window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=function(n){return function(){let a=arguments;return a[0]==="webgl"&&(a=[].slice.call(arguments),a[0]="experimental-webgl"),n.apply(this,a)}}(HTMLCanvasElement.prototype.getContext)),{createAugmentedTypedArray:F,createAttribsFromArrays:mn,createBuffersFromArrays:Q,createBufferInfoFromArrays:Tn,createAttributeSetters:pn,createProgram:J,createProgramFromScripts:wn,createProgramFromSources:cn,createProgramInfo:fn,createUniformSetters:ln,createVAOAndSetAttributes:on,createVAOFromBufferInfo:bn,drawBufferInfo:Z,drawObjectList:e,glEnumToString:r,getExtensionWithKnownPrefixes:En,resizeCanvasToDisplaySize:_,setAttributes:rn,setBuffersAndAttributes:vn,setUniforms:un}})});var Yn=zn(Hn=>{(function(p,E){typeof define=="function"&&define.amd?define([],E):p.m4=E()})(Hn,function(){"use strict";let p=Float32Array;function E(e){let r=p;return p=e,r}function Y(e,r,o){o=o||new p(16);var i=r[0*4+0],n=r[0*4+1],a=r[0*4+2],t=r[0*4+3],v=r[1*4+0],u=r[1*4+1],m=r[1*4+2],f=r[1*4+3],l=r[2*4+0],c=r[2*4+1],s=r[2*4+2],w=r[2*4+3],h=r[3*4+0],b=r[3*4+1],T=r[3*4+2],S=r[3*4+3],g=e[0*4+0],y=e[0*4+1],M=e[0*4+2],R=e[0*4+3],V=e[1*4+0],N=e[1*4+1],z=e[1*4+2],D=e[1*4+3],k=e[2*4+0],j=e[2*4+1],G=e[2*4+2],q=e[2*4+3],X=e[3*4+0],$=e[3*4+1],d=e[3*4+2],nn=e[3*4+3];return o[0]=i*g+n*V+a*k+t*X,o[1]=i*y+n*N+a*j+t*$,o[2]=i*M+n*z+a*G+t*d,o[3]=i*R+n*D+a*q+t*nn,o[4]=v*g+u*V+m*k+f*X,o[5]=v*y+u*N+m*j+f*$,o[6]=v*M+u*z+m*G+f*d,o[7]=v*R+u*D+m*q+f*nn,o[8]=l*g+c*V+s*k+w*X,o[9]=l*y+c*N+s*j+w*$,o[10]=l*M+c*z+s*G+w*d,o[11]=l*R+c*D+s*q+w*nn,o[12]=h*g+b*V+T*k+S*X,o[13]=h*y+b*N+T*j+S*$,o[14]=h*M+b*z+T*G+S*d,o[15]=h*R+b*D+T*q+S*nn,o}function U(e,r,o){return o=o||new p(3),o[0]=e[0]+r[0],o[1]=e[1]+r[1],o[2]=e[2]+r[2],o}function J(e,r,o){return o=o||new p(3),o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],o}function hn(e,r,o){return o=o||new p(3),o[0]=e[0]*r,o[1]=e[1]*r,o[2]=e[2]*r,o}function P(e,r){r=r||new p(3);var o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return o>1e-5&&(r[0]=e[0]/o,r[1]=e[1]/o,r[2]=e[2]/o),r}function wn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function cn(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function L(e,r,o){return o=o||new p(3),o[0]=e[1]*r[2]-e[2]*r[1],o[1]=e[2]*r[0]-e[0]*r[2],o[2]=e[0]*r[1]-e[1]*r[0],o}function ln(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function un(e,r){let o=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2];return o*o+i*i+n*n}function pn(e,r){return Math.sqrt(un(e,r))}function rn(e){return e=e||new p(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function on(e,r){return r=r||new p(16),r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15],r}function bn(e,r,o,i){i=i||new p(16);var n=P(J(e,r)),a=P(L(o,n)),t=P(L(n,a));return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=0,i[4]=t[0],i[5]=t[1],i[6]=t[2],i[7]=0,i[8]=n[0],i[9]=n[1],i[10]=n[2],i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function fn(e,r,o,i,n){n=n||new p(16);var a=Math.tan(Math.PI*.5-.5*e),t=1/(o-i);return n[0]=a/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(o+i)*t,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*i*t*2,n[15]=0,n}function vn(e,r,o,i,n,a,t){return t=t||new p(16),t[0]=2/(r-e),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2/(i-o),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2/(n-a),t[11]=0,t[12]=(e+r)/(e-r),t[13]=(o+i)/(o-i),t[14]=(n+a)/(n-a),t[15]=1,t}function sn(e,r,o,i,n,a,t){t=t||new p(16);var v=r-e,u=i-o,m=a-n;return t[0]=2*n/v,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n/u,t[6]=0,t[7]=0,t[8]=(e+r)/v,t[9]=(i+o)/u,t[10]=-(a+n)/m,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*n*a/m,t[15]=0,t}function En(e,r,o,i){return i=i||new p(16),i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e,i[13]=r,i[14]=o,i[15]=1,i}function _(e,r,o,i,n){n=n||new p(16);var a=e[0],t=e[1],v=e[2],u=e[3],m=e[1*4+0],f=e[1*4+1],l=e[1*4+2],c=e[1*4+3],s=e[2*4+0],w=e[2*4+1],h=e[2*4+2],b=e[2*4+3],T=e[3*4+0],S=e[3*4+1],g=e[3*4+2],y=e[3*4+3];return e!==n&&(n[0]=a,n[1]=t,n[2]=v,n[3]=u,n[4]=m,n[5]=f,n[6]=l,n[7]=c,n[8]=s,n[9]=w,n[10]=h,n[11]=b),n[12]=a*r+m*o+s*i+T,n[13]=t*r+f*o+w*i+S,n[14]=v*r+l*o+h*i+g,n[15]=u*r+c*o+b*i+y,n}function x(e,r){r=r||new p(16);var o=Math.cos(e),i=Math.sin(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=i,r[7]=0,r[8]=0,r[9]=-i,r[10]=o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function F(e,r,o){o=o||new p(16);var i=e[4],n=e[5],a=e[6],t=e[7],v=e[8],u=e[9],m=e[10],f=e[11],l=Math.cos(r),c=Math.sin(r);return o[4]=l*i+c*v,o[5]=l*n+c*u,o[6]=l*a+c*m,o[7]=l*t+c*f,o[8]=l*v-c*i,o[9]=l*u-c*n,o[10]=l*m-c*a,o[11]=l*f-c*t,e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function C(e,r){r=r||new p(16);var o=Math.cos(e),i=Math.sin(e);return r[0]=o,r[1]=0,r[2]=-i,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=i,r[9]=0,r[10]=o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function tn(e,r,o){o=o||new p(16);var i=e[0*4+0],n=e[0*4+1],a=e[0*4+2],t=e[0*4+3],v=e[2*4+0],u=e[2*4+1],m=e[2*4+2],f=e[2*4+3],l=Math.cos(r),c=Math.sin(r);return o[0]=l*i-c*v,o[1]=l*n-c*u,o[2]=l*a-c*m,o[3]=l*t-c*f,o[8]=l*v+c*i,o[9]=l*u+c*n,o[10]=l*m+c*a,o[11]=l*f+c*t,e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function A(e,r){r=r||new p(16);var o=Math.cos(e),i=Math.sin(e);return r[0]=o,r[1]=i,r[2]=0,r[3]=0,r[4]=-i,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function I(e,r,o){o=o||new p(16);var i=e[0*4+0],n=e[0*4+1],a=e[0*4+2],t=e[0*4+3],v=e[1*4+0],u=e[1*4+1],m=e[1*4+2],f=e[1*4+3],l=Math.cos(r),c=Math.sin(r);return o[0]=l*i+c*v,o[1]=l*n+c*u,o[2]=l*a+c*m,o[3]=l*t+c*f,o[4]=l*v-c*i,o[5]=l*u-c*n,o[6]=l*m-c*a,o[7]=l*f-c*t,e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function an(e,r,o){o=o||new p(16);var i=e[0],n=e[1],a=e[2],t=Math.sqrt(i*i+n*n+a*a);i/=t,n/=t,a/=t;var v=i*i,u=n*n,m=a*a,f=Math.cos(r),l=Math.sin(r),c=1-f;return o[0]=v+(1-v)*f,o[1]=i*n*c+a*l,o[2]=i*a*c-n*l,o[3]=0,o[4]=i*n*c-a*l,o[5]=u+(1-u)*f,o[6]=n*a*c+i*l,o[7]=0,o[8]=i*a*c+n*l,o[9]=n*a*c-i*l,o[10]=m+(1-m)*f,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function en(e,r,o,i){i=i||new p(16);var n=r[0],a=r[1],t=r[2],v=Math.sqrt(n*n+a*a+t*t);n/=v,a/=v,t/=v;var u=n*n,m=a*a,f=t*t,l=Math.cos(o),c=Math.sin(o),s=1-l,w=u+(1-u)*l,h=n*a*s+t*c,b=n*t*s-a*c,T=n*a*s-t*c,S=m+(1-m)*l,g=a*t*s+n*c,y=n*t*s+a*c,M=a*t*s-n*c,R=f+(1-f)*l,V=e[0],N=e[1],z=e[2],D=e[3],k=e[4],j=e[5],G=e[6],q=e[7],X=e[8],$=e[9],d=e[10],nn=e[11];return i[0]=w*V+h*k+b*X,i[1]=w*N+h*j+b*$,i[2]=w*z+h*G+b*d,i[3]=w*D+h*q+b*nn,i[4]=T*V+S*k+g*X,i[5]=T*N+S*j+g*$,i[6]=T*z+S*G+g*d,i[7]=T*D+S*q+g*nn,i[8]=y*V+M*k+R*X,i[9]=y*N+M*j+R*$,i[10]=y*z+M*G+R*d,i[11]=y*D+M*q+R*nn,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i}function B(e,r,o,i){return i=i||new p(16),i[0]=e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function K(e,r,o,i,n){return n=n||new p(16),n[0]=r*e[0*4+0],n[1]=r*e[0*4+1],n[2]=r*e[0*4+2],n[3]=r*e[0*4+3],n[4]=o*e[1*4+0],n[5]=o*e[1*4+1],n[6]=o*e[1*4+2],n[7]=o*e[1*4+3],n[8]=i*e[2*4+0],n[9]=i*e[2*4+1],n[10]=i*e[2*4+2],n[11]=i*e[2*4+3],e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n}function mn(e,r,o,i){i=i||new p(16);let n=r[0],a=r[1],t=r[2],v=r[3],u=n+n,m=a+a,f=t+t,l=n*u,c=n*m,s=n*f,w=a*m,h=a*f,b=t*f,T=v*u,S=v*m,g=v*f,y=o[0],M=o[1],R=o[2];return i[0]=(1-(w+b))*y,i[1]=(c+g)*y,i[2]=(s-S)*y,i[3]=0,i[4]=(c-g)*M,i[5]=(1-(l+b))*M,i[6]=(h+T)*M,i[7]=0,i[8]=(s+S)*R,i[9]=(h-T)*R,i[10]=(1-(l+w))*R,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function xn(e,r){let o=e[0],i=e[4],n=e[8],a=e[1],t=e[5],v=e[9],u=e[2],m=e[6],f=e[10],l=o+t+f;if(l>0){let c=.5/Math.sqrt(l+1);r[3]=.25/c,r[0]=(m-v)*c,r[1]=(n-u)*c,r[2]=(a-i)*c}else if(o>t&&o>f){let c=2*Math.sqrt(1+o-t-f);r[3]=(m-v)/c,r[0]=.25*c,r[1]=(i+a)/c,r[2]=(n+u)/c}else if(t>f){let c=2*Math.sqrt(1+t-o-f);r[3]=(n-u)/c,r[0]=(i+a)/c,r[1]=.25*c,r[2]=(v+m)/c}else{let c=2*Math.sqrt(1+f-o-t);r[3]=(a-i)/c,r[0]=(n+u)/c,r[1]=(v+m)/c,r[2]=.25*c}}function Sn(e,r,o,i){let n=m4.length(e.slice(0,3)),a=m4.length(e.slice(4,7)),t=m4.length(e.slice(8,11));gn(e)<0&&(n=-n),r[0]=e[12],r[1]=e[13],r[2]=e[14];let u=m4.copy(e),m=1/n,f=1/a,l=1/t;u[0]*=m,u[1]*=m,u[2]*=m,u[4]*=f,u[5]*=f,u[6]*=f,u[8]*=l,u[9]*=l,u[10]*=l,xn(u,o),i[0]=n,i[1]=a,i[2]=t}function gn(e){var r=e[0*4+0],o=e[0*4+1],i=e[0*4+2],n=e[0*4+3],a=e[1*4+0],t=e[1*4+1],v=e[1*4+2],u=e[1*4+3],m=e[2*4+0],f=e[2*4+1],l=e[2*4+2],c=e[2*4+3],s=e[3*4+0],w=e[3*4+1],h=e[3*4+2],b=e[3*4+3],T=l*b,S=h*c,g=v*b,y=h*u,M=v*c,R=l*u,V=i*b,N=h*n,z=i*c,D=l*n,k=i*u,j=v*n,G=T*t+y*f+M*w-(S*t+g*f+R*w),q=S*o+V*f+D*w-(T*o+N*f+z*w),X=g*o+N*t+k*w-(y*o+V*t+j*w),$=R*o+z*t+j*f-(M*o+D*t+k*f);return 1/(r*G+a*q+m*X+s*$)}function _n(e,r){r=r||new p(16);var o=e[0*4+0],i=e[0*4+1],n=e[0*4+2],a=e[0*4+3],t=e[1*4+0],v=e[1*4+1],u=e[1*4+2],m=e[1*4+3],f=e[2*4+0],l=e[2*4+1],c=e[2*4+2],s=e[2*4+3],w=e[3*4+0],h=e[3*4+1],b=e[3*4+2],T=e[3*4+3],S=c*T,g=b*s,y=u*T,M=b*m,R=u*s,V=c*m,N=n*T,z=b*a,D=n*s,k=c*a,j=n*m,G=u*a,q=f*h,X=w*l,$=t*h,d=w*v,nn=t*l,Fn=f*v,Mn=o*h,Rn=w*i,In=o*l,Bn=f*i,Cn=o*v,On=t*i,Ln=S*v+M*l+R*h-(g*v+y*l+V*h),Pn=g*i+N*l+k*h-(S*i+z*l+D*h),Vn=y*i+z*v+j*h-(M*i+N*v+G*h),Nn=V*i+D*v+G*l-(R*i+k*v+j*l),H=1/(o*Ln+t*Pn+f*Vn+w*Nn);return r[0]=H*Ln,r[1]=H*Pn,r[2]=H*Vn,r[3]=H*Nn,r[4]=H*(g*t+y*f+V*w-(S*t+M*f+R*w)),r[5]=H*(S*o+z*f+D*w-(g*o+N*f+k*w)),r[6]=H*(M*o+N*t+G*w-(y*o+z*t+j*w)),r[7]=H*(R*o+k*t+j*f-(V*o+D*t+G*f)),r[8]=H*(q*m+d*s+nn*T-(X*m+$*s+Fn*T)),r[9]=H*(X*a+Mn*s+Bn*T-(q*a+Rn*s+In*T)),r[10]=H*($*a+Rn*m+Cn*T-(d*a+Mn*m+On*T)),r[11]=H*(Fn*a+In*m+On*s-(nn*a+Bn*m+Cn*s)),r[12]=H*($*c+Fn*b+X*u-(nn*b+q*u+d*c)),r[13]=H*(In*b+q*n+Rn*c-(Mn*c+Bn*b+X*n)),r[14]=H*(Mn*u+On*b+d*n-(Cn*b+$*n+Rn*u)),r[15]=H*(Cn*c+nn*n+Bn*u-(In*u+On*c+Fn*n)),r}function An(e,r,o){o=o||new p(4);for(var i=0;i<4;++i){o[i]=0;for(var n=0;n<4;++n)o[i]+=r[n]*e[n*4+i]}return o}function O(e,r,o){o=o||new p(3);var i=r[0],n=r[1],a=r[2],t=i*e[0*4+3]+n*e[1*4+3]+a*e[2*4+3]+e[3*4+3];return o[0]=(i*e[0*4+0]+n*e[1*4+0]+a*e[2*4+0]+e[3*4+0])/t,o[1]=(i*e[0*4+1]+n*e[1*4+1]+a*e[2*4+1]+e[3*4+1])/t,o[2]=(i*e[0*4+2]+n*e[1*4+2]+a*e[2*4+2]+e[3*4+2])/t,o}function Tn(e,r,o){o=o||new p(3);var i=r[0],n=r[1],a=r[2];return o[0]=i*e[0*4+0]+n*e[1*4+0]+a*e[2*4+0],o[1]=i*e[0*4+1]+n*e[1*4+1]+a*e[2*4+1],o[2]=i*e[0*4+2]+n*e[1*4+2]+a*e[2*4+2],o}function Q(e,r,o){o=o||new p(3);var i=_n(e),n=r[0],a=r[1],t=r[2];return o[0]=n*i[0*4+0]+a*i[0*4+1]+t*i[0*4+2],o[1]=n*i[1*4+0]+a*i[1*4+1]+t*i[1*4+2],o[2]=n*i[2*4+0]+a*i[2*4+1]+t*i[2*4+2],o}function Z(e,r){return r=r||new p(16),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}return{copy:Z,lookAt:bn,addVectors:U,subtractVectors:J,scaleVector:hn,distance:pn,distanceSq:un,normalize:P,compose:mn,cross:L,decompose:Sn,dot:ln,identity:rn,transpose:on,length:wn,lengthSq:cn,orthographic:vn,frustum:sn,perspective:fn,translation:En,translate:_,xRotation:x,yRotation:C,zRotation:A,xRotate:F,yRotate:tn,zRotate:I,axisRotation:an,axisRotate:en,scaling:B,scale:K,multiply:Y,inverse:_n,transformVector:An,transformPoint:O,transformDirection:Tn,transformNormal:Q,setDefaultType:E}})});var yn=Dn(jn()),W=Dn(Yn());"use strict";Number.prototype.map=function(p,E,Y,U){return(this-p)*(U-Y)/(E-p)+Y};function Jn(p){let E=[[0,0,0]],Y=[[0,0]],U=[[0,0,0]],J=[[0,0,0]],hn=[E,Y,U,J],P=[[],[],[],[]],wn=[],cn=[],L,ln=["default"],un="default",pn="default",rn=()=>{};function on(){L&&L.data.position.length&&(L=void 0)}function bn(){if(!L){let _=[],x=[],F=[],C=[];P=[_,x,F,C],L={object:pn,groups:ln,material:un,data:{position:_,texcoord:x,normal:F,color:C}},cn.push(L)}}function fn(_){_.split("/").forEach((F,C)=>{if(!F)return;let tn=parseInt(F),A=tn+(tn>=0?0:hn[C].length);P[C].push(...hn[C][A]),C===0&&J.length>1&&L.data.color.push(...J[A])})}let vn={v(_){_.length>3?(E.push(_.slice(0,3).map(parseFloat)),J.push(_.slice(3).map(parseFloat))):E.push(_.map(parseFloat))},vn(_){U.push(_.map(parseFloat))},vt(_){Y.push(_.map(parseFloat))},f(_){bn();let x=_.length-2;for(let F=0;F<x;++F)fn(_[0]),fn(_[F+1]),fn(_[F+2])},s:rn,mtllib(_,x){wn.push(x)},usemtl(_,x){un=x,on()},g(_){ln=_,on()},o(_,x){pn=x,on()}},sn=/(\w*)(?: )*(.*)/,En=p.split(`
`);for(let _=0;_<En.length;++_){let x=En[_].trim();if(x===""||x.startsWith("#"))continue;let F=sn.exec(x);if(!F)continue;let[,C,tn]=F,A=x.split(/\s+/).slice(1),I=vn[C];if(!I){console.warn("unhandled keyword:",C);continue}I(A,tn)}for(let _ of cn)_.data=Object.fromEntries(Object.entries(_.data).filter(([,x])=>x.length>0));return{geometries:cn,materialLibs:wn}}async function Qn(){let E=document.querySelector("#canvas").getContext("webgl");if(!E)return;let Y=`
  attribute vec4 a_position;
  attribute vec3 a_normal;
  attribute vec4 a_color;
  attribute vec2 texCoord;
 
  varying vec2 texCoordV;

  uniform mat4 u_projection;
  uniform mat4 u_view;
  uniform mat4 u_world;

  varying vec3 v_normal;
  varying vec4 v_color;

  void main() {
    gl_Position = u_projection * u_view * u_world * a_position;
    texCoordV = texCoord;
    v_normal = mat3(u_world) * a_normal;
    v_color = a_color;
  }
  `,U=`
  precision highp float;

  varying vec3 v_normal;
  varying vec4 v_color;
  varying vec2 texCoordV;

  uniform vec4 u_diffuse;
  uniform vec3 u_lightDirection;
  
  uniform vec2 u_mouse;
  uniform float u_height;
  uniform float u_time;
  uniform vec2 u_resolution;
  mat3 yuv2rgb = mat3(0.7, 0.0, 1.13983,
    1.0, -0.39465, -0.58060,
    1.0, 2.03211, 0.0);

  // RGB to YUV matrix
  mat3 rgb2yuv = mat3(0.2126, 0.7152, 0.0722,
      -0.09991, -0.33609, 0.43600,
      0.615, -0.5586, -0.05639);

  void main(){
    vec3 normal = normalize(v_normal);
    vec2 st = gl_FragCoord.xy/u_resolution * normal.z;
    vec3 color = vec3(0.0);

    // UV values goes from -1 to 1
    // So we need to remap st (0.0 to 1.0)
    st -= 0.5;  // becomes -0.5 to 0.5
    st *= 2.0;  // becomes -1.0 to 1.0

    // we pass st as the y & z values of
    // a three dimensional vector to be
    // properly multiply by a 3x3 matrix
    color = yuv2rgb * vec3(abs(sin(u_time * 0.5)), st.x * (u_height + 1.0), 0.1);

    gl_FragColor = vec4(color,1.0);
  }
    
  `,J=function(A){E.canvas.width=0+window.scrollY.map(0,A,1440,1075),E.canvas.height=0+window.scrollY.map(0,A,692,516.96)},hn=function(A){document.getElementById("number_purple").innerHTML=A>=15?`${A}s or ${A-15}s longer than average`:`${A}s`},P=yn.webglUtils.createProgramInfo(E,[Y,U]),cn=await(await fetch("/GL/iphone11.txt")).text(),L=Jn(cn),ln=L.geometries.map(({data:A})=>{A.color?A.position.length===A.color.length&&(A.color={numComponents:3,data:A.color}):A.color={value:[1,1,1,1]};let I=yn.webglUtils.createBufferInfoFromArrays(E,A);return{material:{u_diffuse:[1,1,1,1]},bufferInfo:I}});function un(A){let I=A.slice(0,3),an=A.slice(0,3);for(let en=3;en<A.length;en+=3)for(let B=0;B<3;++B){let K=A[en+B];I[B]=Math.min(K,I[B]),an[B]=Math.max(K,an[B])}return{min:I,max:an}}function pn(A){return A.reduce(({min:I,max:an},{data:en})=>{let B=un(en.position);return{min:I.map((K,mn)=>Math.min(B.min[mn],K)),max:an.map((K,mn)=>Math.max(B.max[mn],K))}},{min:Array(3).fill(Number.POSITIVE_INFINITY),max:Array(3).fill(Number.NEGATIVE_INFINITY)})}let rn=pn(L.geometries),on=W.m4.subtractVectors(rn.max,rn.min),bn=W.m4.scaleVector(W.m4.addVectors(rn.min,W.m4.scaleVector(on,.5)),-1),fn=[-.1,.05,0],vn=W.m4.length(on)*1.2,sn=vn/100,En=vn*3,_=new Float32Array(2),x=E.getUniformLocation(P.program,"u_resolution"),F=0;function C(A){return A*Math.PI/180}function tn(A){A*=.001,F++;let I=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight;(function(){document.onmousemove=An;function An(O){var Tn,Q,Z;O=O||window.event,O.pageX==null&&O.clientX!=null&&(Tn=O.target&&O.target.ownerDocument||document,Q=Tn.documentElement,Z=Tn.body,O.pageX=O.clientX+(Q&&Q.scrollLeft||Z&&Z.scrollLeft||0)-(Q&&Q.clientLeft||Z&&Z.clientLeft||0),O.pageY=O.clientY+(Q&&Q.scrollTop||Z&&Z.scrollTop||0)-(Q&&Q.clientTop||Z&&Z.clientTop||0)),_[0]=O.pageX*.001,_[1]=O.pageY*.001}})();let an=W.m4.addVectors(fn,[0,0,vn-window.scrollY.map(0,I,0,1.89)]);F%120==0&&(J(I),F=0),F%60==0&&hn(Math.floor(A)),E.viewport(0,0,E.drawingBufferWidth,E.drawingBufferHeight),E.enable(E.DEPTH_TEST),E.clearColor(.067,.075,.11,1),E.clear(E.COLOR_BUFFER_BIT|E.DEPTH_BUFFER_BIT);let en=C(60),B=E.canvas.clientWidth/E.canvas.clientHeight,K=W.m4.perspective(en,B,sn,En),mn=[0,1,0],xn=W.m4.lookAt(an,fn,mn),Sn=W.m4.inverse(xn),gn={u_lightDirection:W.m4.normalize([-1,2,5]),u_view:Sn,u_projection:K,u_time:A,u_height:window.scrollY.map(0,I,0,1),u_mouse:_};E.useProgram(P.program),E.uniform2f(x,E.canvas.width,E.canvas.height),yn.webglUtils.setUniforms(P,gn);let _n=W.m4.multiply(W.m4.yRotation(window.scrollY.map(0,I,0,6.5)+_[0]*.15),W.m4.xRotation(_[1]*.1));_n=W.m4.translate(_n,...bn);for(let{bufferInfo:An,material:O}of ln)yn.webglUtils.setBuffersAndAttributes(E,P,An),yn.webglUtils.setUniforms(P,{u_world:_n,u_diffuse:O.u_diffuse}),yn.webglUtils.drawBufferInfo(E,An);requestAnimationFrame(tn)}requestAnimationFrame(tn)}Qn();})();
